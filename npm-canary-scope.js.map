{"version":3,"sources":["webpack:///./docs/blog/npm-canary-scope.md"],"names":["_path","_interopRequireDefault","__webpack_require__","_react","_interopRequireWildcard","_classnames","_reactIdealImage","Link","props","to","rest","_objectWithoutProperties","includes","default","createElement","_extends","href","path","join","onClick","e","preventDefault","location","URL","window","origin","history","pushState","Location","pathname","hash","query","getLocation","popStateEvent","CustomEvent","detail","dispatchEvent","defaultProps","imageSources","//www.gravatar.com/avatar/ff725a631f869cdb78beeb003825bb40","Promise","resolve","src","preSrc","height","width","LazyImageComponent","React","Component","[object Object]","args","super","_defineProperty","this","image","ImageProvider","componentDidMount","state","then","c","setState","render","className","placeholder","lqip","srcSet","images","map","i","_objectSpread","_jsx","lazyComponent","provider","_class","_temp","Comp","shouldLoad","children","bind","atIndex","configuration","setBlogHero","heroUrl","stub","_ref3","_ref4","currentPage","target","_ref5","_ref6","id","aria-hidden","_ref7","_ref8","_ref9","_ref10","_ref11","_ref12","_ref13","_ref14","_ref15","_ref16","_ref17","_ref18","_ref19","_ref20","_ref21","_ref22","_ref23","_ref24"],"mappings":"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","file":"npm-canary-scope.js","sourcesContent":["\n      \n      import path from 'path';\n      import React, { Component } from 'react';\n      import makeClass from 'classnames';\n\n      \n  import PropTypes from 'prop-types';\n\n  const getLocation = Location => ({\n    href: Location.href,\n    pathname: Location.pathname,\n    hash: Location.hash,\n    query: Location.query\n  });\n\n  const Link = props => {\n    let {to, ...rest} = props;\n\n    if (to.includes('http')) {\n      return <a {...props} href={to} />\n    }\n\n    if (to[0] === '#') {\n      to = path.join('/auto/','blog/npm-canary-scope.html') + to;\n    }\n\n    return (\n      <a\n        {...rest}\n        href={to}\n        onClick={e => {\n          e.preventDefault();\n\n          if (props.to === '#') {\n            return false;\n          }\n\n          const location = new URL(path.join(window.location.origin, to))\n\n          window.history.pushState(getLocation(location), null, to);\n          props.onClick();\n\n          const popStateEvent = new CustomEvent('changeLocation', { detail: location });\n          dispatchEvent(popStateEvent);\n\n          return false;\n        }}\n      />\n    );\n  };\n\n  Link.defaultProps = {\n    href: '',\n    onClick: () => {}\n  };\n\n  Link.propTypes = {\n    href: PropTypes.string,\n    onClick: PropTypes.func\n  }\n\n      \n  const PluginProvider = ({plugins, name, options, children, ...props}) => {\n    let Plugin = plugins[name];\n    const pluginOptions = Plugin.options;\n\n    if (!Plugin) {\n      return <div />;\n    }\n\n    Plugin = Plugin.component;\n    return (\n      <Plugin\n        {...pluginOptions} \n        options={options ? options.options : {}}\n        {...(options ? options.props : props)}\n        children={children}\n        plugins={plugins}\n      />\n    );\n  };\n\n      \n  class Details extends Component {\n    state = {\n      open: this.props.open\n    }\n\n    render() {\n      return (\n        <details open={this.state.open}>\n          {this.props.children}\n        </details>\n      )\n    }\n  };\n\n      \n      \n    import IdealImage from 'react-ideal-image';\n\n    const imageSources = { '//www.gravatar.com/avatar/ff725a631f869cdb78beeb003825bb40': () => Promise.resolve({\n              default: {\n                src: { src: 'http://www.gravatar.com/avatar/ff725a631f869cdb78beeb003825bb40' },\n                preSrc: 'http://www.gravatar.com/avatar/ff725a631f869cdb78beeb003825bb40',\n                height: 80,\n                width: 80\n              }\n            }) };\n\n    class LazyImageComponent extends React.Component {\n      state = {\n        image: null,\n        ImageProvider: imageSources[this.props.src]\n      }\n\n      componentDidMount() {\n        if (!this.state.image) {\n          this.state.ImageProvider().then(c => {\n            this.setState({\n              image: c.default\n            });\n          });\n        }\n      }\n\n      render() {\n        let { image } = this.state;\n\n        return image && typeof image === 'object' ? (\n          <IdealImage\n            {...this.props}\n            className={makeClass('image', this.props.className)}\n            src={image.src.src}\n            width={image.src.width || image.width}\n            height={image.src.height || image.height}\n            placeholder={{ lqip: image.preSrc }}\n            srcSet={image.src.images\n              ? image.src.images.map(i => ({\n                  ...i,\n                  src: i.path\n                }))\n              : [{\n                  src: image.src,\n                  width: image.width\n                }]\n            }\n          />\n        ) : <img className={makeClass('image', this.props.className)} src={image} />;\n      }\n    }\n  \n      \n  const lazyComponent = provider =>\n    class extends React.Component {\n      static defaultProps = {\n        shouldLoad: true\n      };\n  \n      state = {\n        Comp: null\n      };\n  \n      componentDidMount() {\n        if (!this.state.Comp && this.props.shouldLoad) {\n          provider().then(c => {\n            this.setState({\n              Comp: c.default\n            });\n          });\n        }\n      }\n  \n      render() {\n        const { Comp } = this.state;\n        return Comp ? React.createElement(Comp, this.props, this.props.children || null) : null;\n      }\n    };\n\n\n      const Gist = lazyComponent(() => import(/* webpackChunkName: \"plugin-embed\" */ 'react-gist'))\n      const TweetEmbed = lazyComponent(() => import(/* webpackChunkName: \"plugin-embed\" */ 'react-tweet-embed'))\n    \n      \n    class blogPost extends React.Component {\n      componentDidMount() {\n        if (!this.props.atIndex) {\n          window.configuration.setBlogHero('https://images.unsplash.com/photo-1566386087068-55645996b234?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=1950');\n        }\n      }\n\n      render() {\n        return  (\n          <div className={makeClass('blogPost', this.props.className)}>\n            <p>{this.props.heroUrl}</p>\n            <section>\n              {this.props.stub ? \n    <div className=\"card\">\n      <div className=\"card-content\"><div className=\"media blogHeader\">\n      \n      <div className=\"media-content has-text-centered\">\n        <LazyImageComponent src=\"//www.gravatar.com/avatar/ff725a631f869cdb78beeb003825bb40\" className=\"authorImage\"/>\n\n        <p className=\"title blogTitle\">\n          npm: More Secure Canary Publishing\n        </p>\n        <p className=\"subtitle is-6 blogSubtitle\">\n          <Link currentPage={(this && this.props || props).currentPage} target=\"_blank\" to=\"https://twitter.com/HipsterSmoothie\">Andrew Lisowski</Link>\n        <span> on December 13, 2019<span/></span></p>\n      </div>\n    </div>\n        <div className=\"blogBody\">\n          \n        <p>Publishing canary versions comes with some security risks.\nIf your project is private you have nothing to worry about, but if your project is open source there are some security holes.</p><h2 id=\"attack-vectors\">Attack Vectors <Link currentPage={(this && this.props || props).currentPage} className=\"fas fa-hashtag headerLink\" to=\"#attack-vectors\" aria-hidden=\"true\"/></h2><p>Depending on the build platform you might be able to pass secrets to PR builds for forked repos.\nWhile this makes the developer experience of your project nice, in <code>auto</code>&apos;s case publishing canary versions, it exposes your keys.</p>\n      <div className=\"has-text-centered learnMore\">\n        <Link to=\"/auto/blog/npm-canary-scope.html\">\n          Read More\n        </Link>\n      </div>\n    </div>\n      </div>\n    </div>    \n   : \n    <div className=\"card\">\n      <div className=\"card-content\"><div className=\"media blogHeader\">\n      \n      <div className=\"media-content has-text-centered\">\n        <LazyImageComponent src=\"//www.gravatar.com/avatar/ff725a631f869cdb78beeb003825bb40\" className=\"authorImage\"/>\n\n        <p className=\"title blogTitle\">\n          npm: More Secure Canary Publishing\n        </p>\n        <p className=\"subtitle is-6 blogSubtitle\">\n          <Link currentPage={(this && this.props || props).currentPage} target=\"_blank\" to=\"https://twitter.com/HipsterSmoothie\">Andrew Lisowski</Link>\n        <span> on December 13, 2019<span/></span></p>\n      </div>\n    </div>\n        <div className=\"blogBody\">\n          \n        <div>\n    \n  <p>Publishing canary versions comes with some security risks.\nIf your project is private you have nothing to worry about, but if your project is open source there are some security holes.</p>\n<h2 id=\"attack-vectors\">Attack Vectors <Link currentPage={(this && this.props || props).currentPage} className=\"fas fa-hashtag headerLink\" to=\"#attack-vectors\" aria-hidden=\"true\"/></h2>\n<p>Depending on the build platform you might be able to pass secrets to PR builds for forked repos.\nWhile this makes the developer experience of your project nice, in <code>auto</code>&apos;s case publishing canary versions, it exposes your keys.</p>\n<p>An attacker could:</p>\n<ol>\n<li>print secrets</li>\n<li>send secrets to some server</li>\n<li>modify <code>auto</code> to publish to the latest tag instead of <code>canary</code></li>\n</ol>\n<p>No amount of code can fix these problems.\nIf your release keys are in everyone&apos;s CI builds an attacker can do any number of things to modify what you intend for <code>auto</code> to do (or any other release method run in the CI).</p>\n<h2 id=\"solution\">Solution <Link currentPage={(this && this.props || props).currentPage} className=\"fas fa-hashtag headerLink\" to=\"#solution\" aria-hidden=\"true\"/></h2>\n<p>The solution for this is actually quite simple:</p>\n<ol>\n<li>Create a test scope that you publish canaries under (ex: <code>@auto-canary</code> or <code>@auto-test</code>)</li>\n<li>Create a user that only has access to that scope</li>\n<li>Set the default <code>NPM_TOKEN</code> to a token that can publish to that scope (this is used for any pull request)</li>\n<li>Set up a <code>secure</code> token that is only accessible on the main fork (still named <code>NPM_TOKEN</code>)</li>\n</ol>\n<p>Step 3 might not be possible on your build platform.</p>\n<p>The following are the ways the <code>auto</code> team knows how to do it.\nIf you do not see the method for you build platform, please make a pull request!</p>\n<ul>\n<li><Link currentPage={(this && this.props || props).currentPage} target=\"_blank\" to=\"https://circleci.com/docs/2.0/contexts/\" className=\"external-link\">CircleCI Context</Link> - Contexts provide a mechanism for securing and sharing environment variables across projects. The environment variables are defined as name/value pairs and are injected at runtime.</li>\n</ul>\n<h2 id=\"usage\">Usage <Link currentPage={(this && this.props || props).currentPage} className=\"fas fa-hashtag headerLink\" to=\"#usage\" aria-hidden=\"true\"/></h2>\n<p>To use this work flow in <code>auto</code>, supply the following configuration to the <code>npm</code> plugin.</p>\n<pre><code className=\"language-json\">&#123;<br />  <span className=\"hljs-attr\">&quot;plugins&quot;</span>: [<br />    [<br />      <span className=\"hljs-string\">&quot;npm&quot;</span>,<br />      &#123;<br />        <span className=\"hljs-attr\">&quot;canaryScope&quot;</span>: <span className=\"hljs-string\">&quot;@auto-canary&quot;</span><br />      &#125;<br />    ]<br />  ]<br />&#125;<br /></code></pre>\n<p>Now when people make pull requests to your repos:</p>\n<ol>\n<li>your CI can run <code>auto shipit</code></li>\n<li>the canary versions will get published under your <code>canaryScope</code></li>\n</ol>\n</div></div>\n      </div>\n    </div>    \n  }\n            </section>\n          </div>\n        );\n      }\n    }\n\n    export default blogPost;\n  \n    "],"sourceRoot":""}